name: Enforce Branch Lock

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  check-lock:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Verificar se a branch está bloqueada
        run: |
          LOCK_FILE="branch-lock.json"
          if [ ! -f "$LOCK_FILE" ]; then
            echo "Arquivo de bloqueio não encontrado. Assumindo que a branch está desbloqueada."
            exit 0
          fi

          IS_LOCKED=$(jq -r '.locked' "$LOCK_FILE")
          if [ "$IS_LOCKED" = "true" ]; then
            echo "Branch está bloqueada. Push ou merge não é permitido."
            exit 1
          fi

          echo "Branch está desbloqueada. Prosseguindo com push ou merge."
